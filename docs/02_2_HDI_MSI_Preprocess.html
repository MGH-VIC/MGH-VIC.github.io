

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MSI HDIpreprocessing &mdash; miaaim 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=9aaca0cf" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=d45e8c67"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="HE TMA Core Extraction" href="03_HE_preprocess_TIFF.html" />
    <link rel="prev" title="MSI Export to HDF5" href="02_1_MSI_ExportHDF5.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: 5DADE2" >

          
          
          <a href="index.html" class="icon icon-home">
            miaaim
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide / Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#linux-os-x">Linux / OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#windows">Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-miaaim-in-python">Installing MIAAIM in Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#tma013">TMA013</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#download-data">Download Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#image-preprocessing">Image Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#manual-image-registration">Manual Image Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#image-registration">Image Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#image-segmentation">Image Segmentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="directory.html">Folder Structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="directory.html#input">input</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#hdiprep">hdiprep</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#hdireg">hdireg</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#docs">docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="workflows.html#image-preparation-hdiprep">Image Preparation (HDIprep)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="workflows.html#yaml-parameter-file-input-basics">YAML Parameter File Input Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflows.html#high-parameter-image-processing">High-Parameter Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflows.html#histological-image-processing">Histological Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="workflows.html#hdiprep-implementation-guide">HDIprep Implementation Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="workflows.html#image-registration-hdireg">Image Registration (HDIreg)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="workflows.html#hdireg-implementation-guide">HDIreg Implementation Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="workflows.html#tissue-state-modelling-patchmap">Tissue State Modelling (PatchMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="workflows.html#cross-system-tissue-information-transfer-i-patchmap">Cross-System/Tissue Information Transfer (i-PatchMAP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameter Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parameters.html#hdiprep">HDIprep</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html#hdireg">HDIreg</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#adding-imaging-modalities">Adding Imaging Modalities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#importing-new-modalities-adding-file-formats">Importing New Modalities / Adding File Formats</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick Start Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html">IMC HDIpreprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Set-paths-to-data-and-get-marker-information">Set paths to data and get marker information</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Preprocessing-and-quality-control">Preprocessing and quality control</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Create-Mask">Create Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Fill-Mask">Fill Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Apply-Mask-to-IMC-image">Apply Mask to IMC image</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Create-UMAP-embedding-of-masked-IMC-image">Create UMAP embedding of masked IMC image</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_HDI_IMC_Preprocessing.html#Export-Embedding">Export Embedding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="02_1_MSI_ExportHDF5.html">MSI Export to HDF5</a><ul>
<li class="toctree-l2"><a class="reference internal" href="02_1_MSI_ExportHDF5.html#Set-paths-to-csv-data-with-root-mean-square-normalized-MSI-data">Set paths to csv data with root mean square normalized MSI data</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_1_MSI_ExportHDF5.html#Convert-to-HDF5-and-export">Convert to HDF5 and export</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MSI HDIpreprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Set-paths-to-data-and-get-marker-information">Set paths to data and get marker information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Iterate-Through-Cores-and-Extract-Data">Iterate Through Cores and Extract Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_HE_preprocess_TIFF.html">HE TMA Core Extraction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="03_HE_preprocess_TIFF.html#Read-Core-Labels-and-Export-Individual-ROIs">Read Core Labels and Export Individual ROIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04_ilastikTraining.html">Training Ilastik</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_ilastikHeadless.html">Ilastik Generate</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_HDI_Registration.html">HDI Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_HDI_Segmentation.html">HDI Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_Quant.html">Single Cell Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MIAAIM in Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="python.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#usage-without-docker-install-with-pip">Usage without Docker / Install with Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#reproducibility-with-pip">Reproducibility with Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#hdi-utility-functions-hdi-utils">HDI Utility Functions (hdi-utils)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python-workflows.html">Workflow Implementations in Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#image-preparation-hdiprep">Image Preparation (HDIprep)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#steady-state-umap-compression">Steady-state UMAP compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#histological-image-processing">Histological Image Processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#image-registration-hdireg">Image Registration (HDIreg)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#elastix">elastix</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#transformix">transformix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#tissue-state-modeling-patchmap">Tissue State Modeling (PatchMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#cross-system-tissue-information-transfer-i-patchmap">Cross-System/Tissue Information Transfer (i-PatchMAP)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background on MIAAIM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="elastix.html">Elastix Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="elastix.html#registration-parameter-files-elastix">Registration Parameter Files (Elastix)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#multi-channel-input">Multi-channel Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#single-channel-input">Single-channel Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#help-the-registration-with-manual-landmarks">Help the Registration with Manual Landmarks</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#outputs">Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="elastix.html#applying-transformations-transformix">Applying Transformations (Transformix)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#adding-imaging-modalities">Adding Imaging Modalities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#importing-new-modalities-adding-file-formats">Importing New Modalities / Adding File Formats</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contact</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Funding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: 5DADE2" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">miaaim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MSI HDIpreprocessing</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/JoshuaHess12/miaaim/blob/0.0.102_2_HDI_MSI_Preprocess.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="MSI-HDIpreprocessing">
<h1>MSI HDIpreprocessing<a class="headerlink" href="#MSI-HDIpreprocessing" title="Link to this heading"></a></h1>
<p>This notebook reads the MSI data and runs an optimized form of UMAP on the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import custom modules</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">miaaim.proc.hdiproc</span><span class="w"> </span><span class="kn">import</span> <span class="n">HDIpreprocessing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">miaaim.io.imread</span><span class="w"> </span><span class="kn">import</span> <span class="n">_import</span>

<span class="c1"># import other modules</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="c1"># check versions and environment executable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">version</span>
<span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-04-23 22:02:22.066589: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;/opt/conda/envs/miaaim-dev/bin/python&#39;
</pre></div></div>
</div>
<section id="Set-paths-to-data-and-get-marker-information">
<h2>Set paths to data and get marker information<a class="headerlink" href="#Set-paths-to-data-and-get-marker-information" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set path to data folder</span>
<span class="n">data_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/opt/miaaim-20220912-TMA4/data&quot;</span><span class="p">)</span>
<span class="c1"># read csv file with MSI data</span>
<span class="n">msiRMS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;msi_rms_tma_peptides.csv&quot;</span><span class="p">))</span>
<span class="c1"># get list of cores</span>
<span class="n">coreFolders</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="p">]</span>
<span class="c1"># get unique TMA core names</span>
<span class="n">coreNames</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">list</span><span class="p">(</span><span class="n">msiRMS</span><span class="o">.</span><span class="n">Region</span><span class="o">.</span><span class="n">unique</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msiRMS</span><span class="o">.</span><span class="n">Region</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Iterate-Through-Cores-and-Extract-Data">
<h2>Iterate Through Cores and Extract Data<a class="headerlink" href="#Iterate-Through-Cores-and-Extract-Data" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate through cores and extract data</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">coreNames</span><span class="p">):</span>
    <span class="c1"># get the corresponding core folder</span>
    <span class="n">coreFolder</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coreFolders</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># get the name of this folder</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">coreFolder</span><span class="o">.</span><span class="n">name</span>
    <span class="c1"># get the input folder</span>
    <span class="n">inputMSIFolder</span> <span class="o">=</span> <span class="n">coreFolder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;input/msi&quot;</span><span class="p">)</span>
    <span class="c1"># set input imc folder</span>
    <span class="n">processedIMCfolder</span> <span class="o">=</span> <span class="n">coreFolder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;preprocessing/imc&quot;</span><span class="p">)</span>

    <span class="c1"># create preprocessing object (read hdf5 and associated mask)</span>
    <span class="n">msi</span> <span class="o">=</span> <span class="n">HDIpreprocessing</span><span class="p">(</span>
        <span class="n">paths</span><span class="o">=</span><span class="n">inputMSIFolder</span><span class="p">,</span>
        <span class="n">path_to_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_mem</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="c1"># read imc data</span>
    <span class="n">imcIm</span> <span class="o">=</span> <span class="n">_import</span><span class="o">.</span><span class="n">HDIreader</span><span class="p">(</span><span class="n">path_to_data</span><span class="o">=</span><span class="n">processedIMCfolder</span><span class="p">,</span>
                              <span class="n">path_to_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">subsample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">save_mem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">filename</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="c1"># get shape of imc image</span>
    <span class="n">imcX</span><span class="p">,</span> <span class="n">imcY</span><span class="p">,</span> <span class="n">imcC</span> <span class="o">=</span> <span class="n">imcIm</span><span class="o">.</span><span class="n">hdi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># run dimension reduction for registration preprocessing</span>
    <span class="n">msi</span><span class="o">.</span><span class="n">RunOptimalUMAP</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">landmarks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># map pixels to spatial coordinates</span>
    <span class="n">msi</span><span class="o">.</span><span class="n">SpatiallyMapUMAP</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;coordinate&#39;</span><span class="p">)</span>

    <span class="c1"># export core image</span>
    <span class="n">msi</span><span class="o">.</span><span class="n">Export</span><span class="p">(</span>
        <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_core_msi_UMAP.nii&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">imcX</span><span class="p">,</span> <span class="n">imcY</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="c1"># export mask</span>
    <span class="n">msi</span><span class="o">.</span><span class="n">ExportMask</span><span class="p">(</span>
        <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_core_msi_mask.tif&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">imcX</span><span class="p">,</span> <span class="n">imcY</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># export documentation and QC images</span>
    <span class="n">msi</span><span class="o">.</span><span class="n">QC</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  0%|                                                                                                                                 | 0/48 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/input/msi/ROI010_PROSTATE_TMA001_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/input/msi/ROI010_PROSTATE_TMA001.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/imc/ROI010_PROSTATE_TMA001_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/imc/ROI010_PROSTATE_TMA001_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/input/msi/ROI010_PROSTATE_TMA001.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi/ROI010_PROSTATE_TMA001_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi/ROI010_PROSTATE_TMA001_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi/ROI010_PROSTATE_TMA001_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi/ROI010_PROSTATE_TMA001_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/preprocessing/msi/ROI010_PROSTATE_TMA001_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/qc/preprocessing/msi/ROI010_PROSTATE_TMA001_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/qc/preprocessing/msi/ROI010_PROSTATE_TMA001_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/qc/preprocessing/msi/ROI010_PROSTATE_TMA001_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI010_PROSTATE_TMA001/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  2%|██▍                                                                                                                    | 1/48 [01:29&lt;1:09:53, 89.22s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/input/msi/ROI011_PROSTATE_TMA002_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/input/msi/ROI011_PROSTATE_TMA002.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/imc/ROI011_PROSTATE_TMA002_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/imc/ROI011_PROSTATE_TMA002_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/input/msi/ROI011_PROSTATE_TMA002.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi/ROI011_PROSTATE_TMA002_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi/ROI011_PROSTATE_TMA002_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi/ROI011_PROSTATE_TMA002_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi/ROI011_PROSTATE_TMA002_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/preprocessing/msi/ROI011_PROSTATE_TMA002_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/qc/preprocessing/msi/ROI011_PROSTATE_TMA002_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/qc/preprocessing/msi/ROI011_PROSTATE_TMA002_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/qc/preprocessing/msi/ROI011_PROSTATE_TMA002_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI011_PROSTATE_TMA002/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  4%|████▉                                                                                                                  | 2/48 [02:44&lt;1:02:02, 80.92s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/input/msi/ROI012_PROSTATE_TMA003_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/input/msi/ROI012_PROSTATE_TMA003.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/imc/ROI012_PROSTATE_TMA003_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/imc/ROI012_PROSTATE_TMA003_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/input/msi/ROI012_PROSTATE_TMA003.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi/ROI012_PROSTATE_TMA003_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi/ROI012_PROSTATE_TMA003_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi/ROI012_PROSTATE_TMA003_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi/ROI012_PROSTATE_TMA003_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/preprocessing/msi/ROI012_PROSTATE_TMA003_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/qc/preprocessing/msi/ROI012_PROSTATE_TMA003_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/qc/preprocessing/msi/ROI012_PROSTATE_TMA003_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/qc/preprocessing/msi/ROI012_PROSTATE_TMA003_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI012_PROSTATE_TMA003/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  6%|███████▌                                                                                                                 | 3/48 [03:57&lt;57:58, 77.30s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/input/msi/ROI013_PROSTATE_TMA004_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/input/msi/ROI013_PROSTATE_TMA004.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/imc/ROI013_PROSTATE_TMA004_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/imc/ROI013_PROSTATE_TMA004_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/input/msi/ROI013_PROSTATE_TMA004.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi/ROI013_PROSTATE_TMA004_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi/ROI013_PROSTATE_TMA004_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi/ROI013_PROSTATE_TMA004_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi/ROI013_PROSTATE_TMA004_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/preprocessing/msi/ROI013_PROSTATE_TMA004_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/qc/preprocessing/msi/ROI013_PROSTATE_TMA004_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/qc/preprocessing/msi/ROI013_PROSTATE_TMA004_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/qc/preprocessing/msi/ROI013_PROSTATE_TMA004_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI013_PROSTATE_TMA004/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  8%|██████████                                                                                                               | 4/48 [05:08&lt;54:52, 74.83s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/input/msi/ROI014_PROSTATE_TMA005_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/input/msi/ROI014_PROSTATE_TMA005.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/imc/ROI014_PROSTATE_TMA005_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/imc/ROI014_PROSTATE_TMA005_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/input/msi/ROI014_PROSTATE_TMA005.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi/ROI014_PROSTATE_TMA005_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi/ROI014_PROSTATE_TMA005_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi/ROI014_PROSTATE_TMA005_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi/ROI014_PROSTATE_TMA005_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/preprocessing/msi/ROI014_PROSTATE_TMA005_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/qc/preprocessing/msi/ROI014_PROSTATE_TMA005_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/qc/preprocessing/msi/ROI014_PROSTATE_TMA005_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/qc/preprocessing/msi/ROI014_PROSTATE_TMA005_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI014_PROSTATE_TMA005/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 10%|████████████▌                                                                                                            | 5/48 [06:22&lt;53:21, 74.46s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/input/msi/ROI015_PROSTATE_TMA006_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/input/msi/ROI015_PROSTATE_TMA006.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/imc/ROI015_PROSTATE_TMA006_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/imc/ROI015_PROSTATE_TMA006_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/input/msi/ROI015_PROSTATE_TMA006.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi/ROI015_PROSTATE_TMA006_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi/ROI015_PROSTATE_TMA006_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi/ROI015_PROSTATE_TMA006_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi/ROI015_PROSTATE_TMA006_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/preprocessing/msi/ROI015_PROSTATE_TMA006_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/qc/preprocessing/msi/ROI015_PROSTATE_TMA006_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/qc/preprocessing/msi/ROI015_PROSTATE_TMA006_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/qc/preprocessing/msi/ROI015_PROSTATE_TMA006_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI015_PROSTATE_TMA006/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 12%|███████████████▏                                                                                                         | 6/48 [07:02&lt;44:00, 62.87s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/input/msi/ROI016_PROSTATE_TMA007_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/input/msi/ROI016_PROSTATE_TMA007.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/imc/ROI016_PROSTATE_TMA007_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/imc/ROI016_PROSTATE_TMA007_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/input/msi/ROI016_PROSTATE_TMA007.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi/ROI016_PROSTATE_TMA007_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi/ROI016_PROSTATE_TMA007_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi/ROI016_PROSTATE_TMA007_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi/ROI016_PROSTATE_TMA007_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/preprocessing/msi/ROI016_PROSTATE_TMA007_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/qc/preprocessing/msi/ROI016_PROSTATE_TMA007_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/qc/preprocessing/msi/ROI016_PROSTATE_TMA007_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/qc/preprocessing/msi/ROI016_PROSTATE_TMA007_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI016_PROSTATE_TMA007/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 15%|█████████████████▋                                                                                                       | 7/48 [08:26&lt;47:35, 69.64s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/input/msi/ROI017_PROSTATE_TMA008_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/input/msi/ROI017_PROSTATE_TMA008.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/imc/ROI017_PROSTATE_TMA008_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/imc/ROI017_PROSTATE_TMA008_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/input/msi/ROI017_PROSTATE_TMA008.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi/ROI017_PROSTATE_TMA008_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi/ROI017_PROSTATE_TMA008_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi/ROI017_PROSTATE_TMA008_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi/ROI017_PROSTATE_TMA008_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/preprocessing/msi/ROI017_PROSTATE_TMA008_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/qc/preprocessing/msi/ROI017_PROSTATE_TMA008_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/qc/preprocessing/msi/ROI017_PROSTATE_TMA008_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/qc/preprocessing/msi/ROI017_PROSTATE_TMA008_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI017_PROSTATE_TMA008/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 17%|████████████████████▏                                                                                                    | 8/48 [09:48&lt;49:03, 73.58s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/input/msi/ROI018_PROSTATE_TMA009_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/input/msi/ROI018_PROSTATE_TMA009.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/imc/ROI018_PROSTATE_TMA009_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/imc/ROI018_PROSTATE_TMA009_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/input/msi/ROI018_PROSTATE_TMA009.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi/ROI018_PROSTATE_TMA009_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi/ROI018_PROSTATE_TMA009_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi/ROI018_PROSTATE_TMA009_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi/ROI018_PROSTATE_TMA009_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/preprocessing/msi/ROI018_PROSTATE_TMA009_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/qc/preprocessing/msi/ROI018_PROSTATE_TMA009_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/qc/preprocessing/msi/ROI018_PROSTATE_TMA009_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/qc/preprocessing/msi/ROI018_PROSTATE_TMA009_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI018_PROSTATE_TMA009/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 19%|██████████████████████▋                                                                                                  | 9/48 [11:11&lt;49:47, 76.61s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/input/msi/ROI021_PROSTATE_TMA012_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/input/msi/ROI021_PROSTATE_TMA012.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/imc/ROI021_PROSTATE_TMA012_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/imc/ROI021_PROSTATE_TMA012_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/input/msi/ROI021_PROSTATE_TMA012.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi/ROI021_PROSTATE_TMA012_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi/ROI021_PROSTATE_TMA012_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi/ROI021_PROSTATE_TMA012_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi/ROI021_PROSTATE_TMA012_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/preprocessing/msi/ROI021_PROSTATE_TMA012_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/qc/preprocessing/msi/ROI021_PROSTATE_TMA012_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/qc/preprocessing/msi/ROI021_PROSTATE_TMA012_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/qc/preprocessing/msi/ROI021_PROSTATE_TMA012_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI021_PROSTATE_TMA012/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 21%|█████████████████████████                                                                                               | 10/48 [12:18&lt;46:44, 73.81s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/input/msi/ROI022_PROSTATE_TMA013_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/input/msi/ROI022_PROSTATE_TMA013.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/imc/ROI022_PROSTATE_TMA013_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/imc/ROI022_PROSTATE_TMA013_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/input/msi/ROI022_PROSTATE_TMA013.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi/ROI022_PROSTATE_TMA013_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi/ROI022_PROSTATE_TMA013_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi/ROI022_PROSTATE_TMA013_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi/ROI022_PROSTATE_TMA013_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/preprocessing/msi/ROI022_PROSTATE_TMA013_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/qc/preprocessing/msi/ROI022_PROSTATE_TMA013_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/qc/preprocessing/msi/ROI022_PROSTATE_TMA013_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/qc/preprocessing/msi/ROI022_PROSTATE_TMA013_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI022_PROSTATE_TMA013/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 23%|███████████████████████████▌                                                                                            | 11/48 [13:39&lt;46:46, 75.86s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/input/msi/ROI023_PROSTATE_TMA015_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/input/msi/ROI023_PROSTATE_TMA015.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/imc/ROI023_PROSTATE_TMA015_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/imc/ROI023_PROSTATE_TMA015_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/input/msi/ROI023_PROSTATE_TMA015.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi/ROI023_PROSTATE_TMA015_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi/ROI023_PROSTATE_TMA015_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi/ROI023_PROSTATE_TMA015_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi/ROI023_PROSTATE_TMA015_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/preprocessing/msi/ROI023_PROSTATE_TMA015_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/qc/preprocessing/msi/ROI023_PROSTATE_TMA015_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/qc/preprocessing/msi/ROI023_PROSTATE_TMA015_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/qc/preprocessing/msi/ROI023_PROSTATE_TMA015_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI023_PROSTATE_TMA015/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|██████████████████████████████                                                                                          | 12/48 [15:11&lt;48:24, 80.69s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/input/msi/ROI024_PROSTATE_TMA016_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/input/msi/ROI024_PROSTATE_TMA016.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/imc/ROI024_PROSTATE_TMA016_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/imc/ROI024_PROSTATE_TMA016_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/input/msi/ROI024_PROSTATE_TMA016.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi/ROI024_PROSTATE_TMA016_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi/ROI024_PROSTATE_TMA016_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi/ROI024_PROSTATE_TMA016_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi/ROI024_PROSTATE_TMA016_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/preprocessing/msi/ROI024_PROSTATE_TMA016_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/qc/preprocessing/msi/ROI024_PROSTATE_TMA016_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/qc/preprocessing/msi/ROI024_PROSTATE_TMA016_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/qc/preprocessing/msi/ROI024_PROSTATE_TMA016_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI024_PROSTATE_TMA016/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 27%|████████████████████████████████▌                                                                                       | 13/48 [16:27&lt;46:15, 79.29s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/input/msi/ROI025_PROSTATE_TMA017_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/input/msi/ROI025_PROSTATE_TMA017.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/imc/ROI025_PROSTATE_TMA017_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/imc/ROI025_PROSTATE_TMA017_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/input/msi/ROI025_PROSTATE_TMA017.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi/ROI025_PROSTATE_TMA017_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi/ROI025_PROSTATE_TMA017_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi/ROI025_PROSTATE_TMA017_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi/ROI025_PROSTATE_TMA017_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/preprocessing/msi/ROI025_PROSTATE_TMA017_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/qc/preprocessing/msi/ROI025_PROSTATE_TMA017_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/qc/preprocessing/msi/ROI025_PROSTATE_TMA017_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/qc/preprocessing/msi/ROI025_PROSTATE_TMA017_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI025_PROSTATE_TMA017/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 29%|███████████████████████████████████                                                                                     | 14/48 [17:45&lt;44:46, 79.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/input/msi/ROI026_PROSTATE_TMA018_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/input/msi/ROI026_PROSTATE_TMA018.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/imc/ROI026_PROSTATE_TMA018_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/imc/ROI026_PROSTATE_TMA018_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/input/msi/ROI026_PROSTATE_TMA018.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi/ROI026_PROSTATE_TMA018_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi/ROI026_PROSTATE_TMA018_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi/ROI026_PROSTATE_TMA018_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi/ROI026_PROSTATE_TMA018_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/preprocessing/msi/ROI026_PROSTATE_TMA018_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/qc/preprocessing/msi/ROI026_PROSTATE_TMA018_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/qc/preprocessing/msi/ROI026_PROSTATE_TMA018_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/qc/preprocessing/msi/ROI026_PROSTATE_TMA018_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI026_PROSTATE_TMA018/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 31%|█████████████████████████████████████▌                                                                                  | 15/48 [18:49&lt;40:59, 74.52s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/input/msi/ROI027_PROSTATE_TMA019_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/input/msi/ROI027_PROSTATE_TMA019.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/imc/ROI027_PROSTATE_TMA019_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/imc/ROI027_PROSTATE_TMA019_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/input/msi/ROI027_PROSTATE_TMA019.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi/ROI027_PROSTATE_TMA019_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi/ROI027_PROSTATE_TMA019_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi/ROI027_PROSTATE_TMA019_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi/ROI027_PROSTATE_TMA019_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/preprocessing/msi/ROI027_PROSTATE_TMA019_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/qc/preprocessing/msi/ROI027_PROSTATE_TMA019_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/qc/preprocessing/msi/ROI027_PROSTATE_TMA019_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/qc/preprocessing/msi/ROI027_PROSTATE_TMA019_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI027_PROSTATE_TMA019/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 33%|████████████████████████████████████████                                                                                | 16/48 [20:11&lt;40:51, 76.60s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/input/msi/ROI028_PROSTATE_TMA020_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/input/msi/ROI028_PROSTATE_TMA020.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/imc/ROI028_PROSTATE_TMA020_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/imc/ROI028_PROSTATE_TMA020_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/input/msi/ROI028_PROSTATE_TMA020.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi/ROI028_PROSTATE_TMA020_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi/ROI028_PROSTATE_TMA020_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi/ROI028_PROSTATE_TMA020_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi/ROI028_PROSTATE_TMA020_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/preprocessing/msi/ROI028_PROSTATE_TMA020_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/qc/preprocessing/msi/ROI028_PROSTATE_TMA020_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/qc/preprocessing/msi/ROI028_PROSTATE_TMA020_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/qc/preprocessing/msi/ROI028_PROSTATE_TMA020_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI028_PROSTATE_TMA020/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 35%|██████████████████████████████████████████▌                                                                             | 17/48 [21:26&lt;39:19, 76.13s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/input/msi/ROI029_PROSTATE_TMA022_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/input/msi/ROI029_PROSTATE_TMA022.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/imc/ROI029_PROSTATE_TMA022_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/imc/ROI029_PROSTATE_TMA022_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/input/msi/ROI029_PROSTATE_TMA022.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi/ROI029_PROSTATE_TMA022_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi/ROI029_PROSTATE_TMA022_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi/ROI029_PROSTATE_TMA022_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi/ROI029_PROSTATE_TMA022_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/preprocessing/msi/ROI029_PROSTATE_TMA022_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/qc/preprocessing/msi/ROI029_PROSTATE_TMA022_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/qc/preprocessing/msi/ROI029_PROSTATE_TMA022_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/qc/preprocessing/msi/ROI029_PROSTATE_TMA022_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI029_PROSTATE_TMA022/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 38%|█████████████████████████████████████████████                                                                           | 18/48 [22:48&lt;38:58, 77.96s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/input/msi/ROI030_PROSTATE_TMA023_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/input/msi/ROI030_PROSTATE_TMA023.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/imc/ROI030_PROSTATE_TMA023_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/imc/ROI030_PROSTATE_TMA023_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/input/msi/ROI030_PROSTATE_TMA023.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi/ROI030_PROSTATE_TMA023_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi/ROI030_PROSTATE_TMA023_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi/ROI030_PROSTATE_TMA023_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi/ROI030_PROSTATE_TMA023_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/preprocessing/msi/ROI030_PROSTATE_TMA023_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/qc/preprocessing/msi/ROI030_PROSTATE_TMA023_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/qc/preprocessing/msi/ROI030_PROSTATE_TMA023_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/qc/preprocessing/msi/ROI030_PROSTATE_TMA023_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI030_PROSTATE_TMA023/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 40%|███████████████████████████████████████████████▌                                                                        | 19/48 [24:10&lt;38:19, 79.28s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/input/msi/ROI031_PROSTATE_TMA024_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/input/msi/ROI031_PROSTATE_TMA024.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/imc/ROI031_PROSTATE_TMA024_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/imc/ROI031_PROSTATE_TMA024_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/sklearn/manifold/_spectral_embedding.py:274: UserWarning: Graph is not fully connected, spectral embedding may not work as expected.
  warnings.warn(

Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/input/msi/ROI031_PROSTATE_TMA024.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi/ROI031_PROSTATE_TMA024_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi/ROI031_PROSTATE_TMA024_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi/ROI031_PROSTATE_TMA024_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi/ROI031_PROSTATE_TMA024_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/preprocessing/msi/ROI031_PROSTATE_TMA024_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/qc/preprocessing/msi/ROI031_PROSTATE_TMA024_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/qc/preprocessing/msi/ROI031_PROSTATE_TMA024_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/qc/preprocessing/msi/ROI031_PROSTATE_TMA024_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI031_PROSTATE_TMA024/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 42%|██████████████████████████████████████████████████                                                                      | 20/48 [25:20&lt;35:42, 76.53s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/input/msi/ROI032_PROSTATE_TMA025_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/input/msi/ROI032_PROSTATE_TMA025.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/imc/ROI032_PROSTATE_TMA025_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/imc/ROI032_PROSTATE_TMA025_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/hdiproc.py:651: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  fig, axs = plt.subplots()

working on /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/input/msi/ROI032_PROSTATE_TMA025.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi/ROI032_PROSTATE_TMA025_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi/ROI032_PROSTATE_TMA025_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi/ROI032_PROSTATE_TMA025_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi/ROI032_PROSTATE_TMA025_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/preprocessing/msi/ROI032_PROSTATE_TMA025_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/qc/preprocessing/msi/ROI032_PROSTATE_TMA025_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/qc/preprocessing/msi/ROI032_PROSTATE_TMA025_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/qc/preprocessing/msi/ROI032_PROSTATE_TMA025_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI032_PROSTATE_TMA025/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 44%|████████████████████████████████████████████████████▌                                                                   | 21/48 [26:46&lt;35:39, 79.24s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/input/msi/ROI033_PROSTATE_TMA026_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/input/msi/ROI033_PROSTATE_TMA026.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/imc/ROI033_PROSTATE_TMA026_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/imc/ROI033_PROSTATE_TMA026_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/input/msi/ROI033_PROSTATE_TMA026.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi/ROI033_PROSTATE_TMA026_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi/ROI033_PROSTATE_TMA026_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi/ROI033_PROSTATE_TMA026_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi/ROI033_PROSTATE_TMA026_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/preprocessing/msi/ROI033_PROSTATE_TMA026_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/qc/preprocessing/msi/ROI033_PROSTATE_TMA026_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/qc/preprocessing/msi/ROI033_PROSTATE_TMA026_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/qc/preprocessing/msi/ROI033_PROSTATE_TMA026_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI033_PROSTATE_TMA026/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 46%|███████████████████████████████████████████████████████                                                                 | 22/48 [27:50&lt;32:20, 74.64s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/input/msi/ROI037_PROSTATE_TMA028_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/input/msi/ROI037_PROSTATE_TMA028.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/imc/ROI037_PROSTATE_TMA028_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/imc/ROI037_PROSTATE_TMA028_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/input/msi/ROI037_PROSTATE_TMA028.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi/ROI037_PROSTATE_TMA028_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi/ROI037_PROSTATE_TMA028_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi/ROI037_PROSTATE_TMA028_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi/ROI037_PROSTATE_TMA028_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/preprocessing/msi/ROI037_PROSTATE_TMA028_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/qc/preprocessing/msi/ROI037_PROSTATE_TMA028_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/qc/preprocessing/msi/ROI037_PROSTATE_TMA028_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/qc/preprocessing/msi/ROI037_PROSTATE_TMA028_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI037_PROSTATE_TMA028/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 48%|█████████████████████████████████████████████████████████▌                                                              | 23/48 [29:02&lt;30:46, 73.85s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/input/msi/ROI038_PROSTATE_TMA030_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/input/msi/ROI038_PROSTATE_TMA030.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/imc/ROI038_PROSTATE_TMA030_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/imc/ROI038_PROSTATE_TMA030_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/input/msi/ROI038_PROSTATE_TMA030.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi/ROI038_PROSTATE_TMA030_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi/ROI038_PROSTATE_TMA030_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi/ROI038_PROSTATE_TMA030_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi/ROI038_PROSTATE_TMA030_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/preprocessing/msi/ROI038_PROSTATE_TMA030_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/qc/preprocessing/msi/ROI038_PROSTATE_TMA030_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/qc/preprocessing/msi/ROI038_PROSTATE_TMA030_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/qc/preprocessing/msi/ROI038_PROSTATE_TMA030_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI038_PROSTATE_TMA030/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|████████████████████████████████████████████████████████████                                                            | 24/48 [30:14&lt;29:17, 73.25s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/input/msi/ROI039_PROSTATE_TMA031_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/input/msi/ROI039_PROSTATE_TMA031.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/imc/ROI039_PROSTATE_TMA031_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/imc/ROI039_PROSTATE_TMA031_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/input/msi/ROI039_PROSTATE_TMA031.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi/ROI039_PROSTATE_TMA031_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi/ROI039_PROSTATE_TMA031_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi/ROI039_PROSTATE_TMA031_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi/ROI039_PROSTATE_TMA031_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/preprocessing/msi/ROI039_PROSTATE_TMA031_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/qc/preprocessing/msi/ROI039_PROSTATE_TMA031_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/qc/preprocessing/msi/ROI039_PROSTATE_TMA031_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/qc/preprocessing/msi/ROI039_PROSTATE_TMA031_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI039_PROSTATE_TMA031/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 52%|██████████████████████████████████████████████████████████████▌                                                         | 25/48 [31:31&lt;28:30, 74.36s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/input/msi/ROI040_PROSTATE_TMA032_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/input/msi/ROI040_PROSTATE_TMA032.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/imc/ROI040_PROSTATE_TMA032_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/imc/ROI040_PROSTATE_TMA032_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/input/msi/ROI040_PROSTATE_TMA032.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi/ROI040_PROSTATE_TMA032_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi/ROI040_PROSTATE_TMA032_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi/ROI040_PROSTATE_TMA032_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi/ROI040_PROSTATE_TMA032_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/preprocessing/msi/ROI040_PROSTATE_TMA032_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/qc/preprocessing/msi/ROI040_PROSTATE_TMA032_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/qc/preprocessing/msi/ROI040_PROSTATE_TMA032_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/qc/preprocessing/msi/ROI040_PROSTATE_TMA032_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI040_PROSTATE_TMA032/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 54%|█████████████████████████████████████████████████████████████████                                                       | 26/48 [32:57&lt;28:32, 77.85s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/input/msi/ROI041_PROSTATE_TMA033_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/input/msi/ROI041_PROSTATE_TMA033.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/imc/ROI041_PROSTATE_TMA033_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/imc/ROI041_PROSTATE_TMA033_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/input/msi/ROI041_PROSTATE_TMA033.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi/ROI041_PROSTATE_TMA033_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi/ROI041_PROSTATE_TMA033_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi/ROI041_PROSTATE_TMA033_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi/ROI041_PROSTATE_TMA033_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/preprocessing/msi/ROI041_PROSTATE_TMA033_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/qc/preprocessing/msi/ROI041_PROSTATE_TMA033_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/qc/preprocessing/msi/ROI041_PROSTATE_TMA033_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/qc/preprocessing/msi/ROI041_PROSTATE_TMA033_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI041_PROSTATE_TMA033/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 56%|███████████████████████████████████████████████████████████████████▌                                                    | 27/48 [34:15&lt;27:14, 77.86s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/input/msi/ROI042_PROSTATE_TMA034_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/input/msi/ROI042_PROSTATE_TMA034.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/imc/ROI042_PROSTATE_TMA034_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/imc/ROI042_PROSTATE_TMA034_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/input/msi/ROI042_PROSTATE_TMA034.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi/ROI042_PROSTATE_TMA034_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi/ROI042_PROSTATE_TMA034_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi/ROI042_PROSTATE_TMA034_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi/ROI042_PROSTATE_TMA034_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/preprocessing/msi/ROI042_PROSTATE_TMA034_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/qc/preprocessing/msi/ROI042_PROSTATE_TMA034_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/qc/preprocessing/msi/ROI042_PROSTATE_TMA034_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/qc/preprocessing/msi/ROI042_PROSTATE_TMA034_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI042_PROSTATE_TMA034/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 58%|██████████████████████████████████████████████████████████████████████                                                  | 28/48 [35:30&lt;25:41, 77.06s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/input/msi/ROI043_PROSTATE_TMA035_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/input/msi/ROI043_PROSTATE_TMA035.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/imc/ROI043_PROSTATE_TMA035_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/imc/ROI043_PROSTATE_TMA035_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/input/msi/ROI043_PROSTATE_TMA035.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi/ROI043_PROSTATE_TMA035_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi/ROI043_PROSTATE_TMA035_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi/ROI043_PROSTATE_TMA035_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi/ROI043_PROSTATE_TMA035_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/preprocessing/msi/ROI043_PROSTATE_TMA035_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/qc/preprocessing/msi/ROI043_PROSTATE_TMA035_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/qc/preprocessing/msi/ROI043_PROSTATE_TMA035_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/qc/preprocessing/msi/ROI043_PROSTATE_TMA035_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI043_PROSTATE_TMA035/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 60%|████████████████████████████████████████████████████████████████████████▌                                               | 29/48 [36:46&lt;24:20, 76.89s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/input/msi/ROI044_PROSTATE_TMA036_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/input/msi/ROI044_PROSTATE_TMA036.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/imc/ROI044_PROSTATE_TMA036_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/imc/ROI044_PROSTATE_TMA036_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/input/msi/ROI044_PROSTATE_TMA036.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi/ROI044_PROSTATE_TMA036_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi/ROI044_PROSTATE_TMA036_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi/ROI044_PROSTATE_TMA036_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi/ROI044_PROSTATE_TMA036_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/preprocessing/msi/ROI044_PROSTATE_TMA036_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/qc/preprocessing/msi/ROI044_PROSTATE_TMA036_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/qc/preprocessing/msi/ROI044_PROSTATE_TMA036_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/qc/preprocessing/msi/ROI044_PROSTATE_TMA036_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI044_PROSTATE_TMA036/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 62%|███████████████████████████████████████████████████████████████████████████                                             | 30/48 [37:48&lt;21:42, 72.38s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/input/msi/ROI045_PROSTATE_TMA038_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/input/msi/ROI045_PROSTATE_TMA038.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/imc/ROI045_PROSTATE_TMA038_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/imc/ROI045_PROSTATE_TMA038_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/input/msi/ROI045_PROSTATE_TMA038.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi/ROI045_PROSTATE_TMA038_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi/ROI045_PROSTATE_TMA038_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi/ROI045_PROSTATE_TMA038_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi/ROI045_PROSTATE_TMA038_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/preprocessing/msi/ROI045_PROSTATE_TMA038_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/qc/preprocessing/msi/ROI045_PROSTATE_TMA038_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/qc/preprocessing/msi/ROI045_PROSTATE_TMA038_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/qc/preprocessing/msi/ROI045_PROSTATE_TMA038_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI045_PROSTATE_TMA038/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 65%|█████████████████████████████████████████████████████████████████████████████▌                                          | 31/48 [39:23&lt;22:23, 79.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/input/msi/ROI046_PROSTATE_TMA039_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/input/msi/ROI046_PROSTATE_TMA039.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/imc/ROI046_PROSTATE_TMA039_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/imc/ROI046_PROSTATE_TMA039_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/input/msi/ROI046_PROSTATE_TMA039.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi/ROI046_PROSTATE_TMA039_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi/ROI046_PROSTATE_TMA039_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi/ROI046_PROSTATE_TMA039_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi/ROI046_PROSTATE_TMA039_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/preprocessing/msi/ROI046_PROSTATE_TMA039_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/qc/preprocessing/msi/ROI046_PROSTATE_TMA039_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/qc/preprocessing/msi/ROI046_PROSTATE_TMA039_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/qc/preprocessing/msi/ROI046_PROSTATE_TMA039_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI046_PROSTATE_TMA039/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 67%|████████████████████████████████████████████████████████████████████████████████                                        | 32/48 [40:32&lt;20:19, 76.21s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/input/msi/ROI048_PROSTATE_TMA042_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/input/msi/ROI048_PROSTATE_TMA042.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/imc/ROI048_PROSTATE_TMA042_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/imc/ROI048_PROSTATE_TMA042_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/input/msi/ROI048_PROSTATE_TMA042.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi/ROI048_PROSTATE_TMA042_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi/ROI048_PROSTATE_TMA042_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi/ROI048_PROSTATE_TMA042_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi/ROI048_PROSTATE_TMA042_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/preprocessing/msi/ROI048_PROSTATE_TMA042_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/qc/preprocessing/msi/ROI048_PROSTATE_TMA042_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/qc/preprocessing/msi/ROI048_PROSTATE_TMA042_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/qc/preprocessing/msi/ROI048_PROSTATE_TMA042_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI048_PROSTATE_TMA042/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 69%|██████████████████████████████████████████████████████████████████████████████████▌                                     | 33/48 [41:41&lt;18:27, 73.85s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/input/msi/ROI049_PROSTATE_TMA044_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/input/msi/ROI049_PROSTATE_TMA044.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/imc/ROI049_PROSTATE_TMA044_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/imc/ROI049_PROSTATE_TMA044_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/input/msi/ROI049_PROSTATE_TMA044.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi/ROI049_PROSTATE_TMA044_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi/ROI049_PROSTATE_TMA044_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi/ROI049_PROSTATE_TMA044_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi/ROI049_PROSTATE_TMA044_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/preprocessing/msi/ROI049_PROSTATE_TMA044_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/qc/preprocessing/msi/ROI049_PROSTATE_TMA044_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/qc/preprocessing/msi/ROI049_PROSTATE_TMA044_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/qc/preprocessing/msi/ROI049_PROSTATE_TMA044_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI049_PROSTATE_TMA044/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 71%|█████████████████████████████████████████████████████████████████████████████████████                                   | 34/48 [42:53&lt;17:07, 73.42s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/input/msi/ROI050_PROSTATE_TMA045_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/input/msi/ROI050_PROSTATE_TMA045.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/imc/ROI050_PROSTATE_TMA045_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/imc/ROI050_PROSTATE_TMA045_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/input/msi/ROI050_PROSTATE_TMA045.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi/ROI050_PROSTATE_TMA045_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi/ROI050_PROSTATE_TMA045_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi/ROI050_PROSTATE_TMA045_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi/ROI050_PROSTATE_TMA045_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/preprocessing/msi/ROI050_PROSTATE_TMA045_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/qc/preprocessing/msi/ROI050_PROSTATE_TMA045_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/qc/preprocessing/msi/ROI050_PROSTATE_TMA045_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/qc/preprocessing/msi/ROI050_PROSTATE_TMA045_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI050_PROSTATE_TMA045/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 73%|███████████████████████████████████████████████████████████████████████████████████████▌                                | 35/48 [44:30&lt;17:28, 80.63s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/input/msi/ROI054_PROSTATE_TMA048_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/input/msi/ROI054_PROSTATE_TMA048.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/imc/ROI054_PROSTATE_TMA048_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/imc/ROI054_PROSTATE_TMA048_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/input/msi/ROI054_PROSTATE_TMA048.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi/ROI054_PROSTATE_TMA048_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi/ROI054_PROSTATE_TMA048_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi/ROI054_PROSTATE_TMA048_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi/ROI054_PROSTATE_TMA048_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/preprocessing/msi/ROI054_PROSTATE_TMA048_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/qc/preprocessing/msi/ROI054_PROSTATE_TMA048_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/qc/preprocessing/msi/ROI054_PROSTATE_TMA048_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/qc/preprocessing/msi/ROI054_PROSTATE_TMA048_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI054_PROSTATE_TMA048/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|██████████████████████████████████████████████████████████████████████████████████████████                              | 36/48 [45:43&lt;15:38, 78.17s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/input/msi/ROI055_PROSTATE_TMA049_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/input/msi/ROI055_PROSTATE_TMA049.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/imc/ROI055_PROSTATE_TMA049_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/imc/ROI055_PROSTATE_TMA049_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/input/msi/ROI055_PROSTATE_TMA049.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi/ROI055_PROSTATE_TMA049_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi/ROI055_PROSTATE_TMA049_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi/ROI055_PROSTATE_TMA049_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi/ROI055_PROSTATE_TMA049_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/preprocessing/msi/ROI055_PROSTATE_TMA049_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/qc/preprocessing/msi/ROI055_PROSTATE_TMA049_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/qc/preprocessing/msi/ROI055_PROSTATE_TMA049_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/qc/preprocessing/msi/ROI055_PROSTATE_TMA049_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI055_PROSTATE_TMA049/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 77%|████████████████████████████████████████████████████████████████████████████████████████████▌                           | 37/48 [46:46&lt;13:29, 73.57s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/input/msi/ROI056_PROSTATE_TMA054_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/input/msi/ROI056_PROSTATE_TMA054.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/imc/ROI056_PROSTATE_TMA054_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/imc/ROI056_PROSTATE_TMA054_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 5
working on /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/input/msi/ROI056_PROSTATE_TMA054.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi/ROI056_PROSTATE_TMA054_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi/ROI056_PROSTATE_TMA054_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi/ROI056_PROSTATE_TMA054_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi/ROI056_PROSTATE_TMA054_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/preprocessing/msi/ROI056_PROSTATE_TMA054_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/qc/preprocessing/msi/ROI056_PROSTATE_TMA054_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/qc/preprocessing/msi/ROI056_PROSTATE_TMA054_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/qc/preprocessing/msi/ROI056_PROSTATE_TMA054_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI056_PROSTATE_TMA054/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 79%|███████████████████████████████████████████████████████████████████████████████████████████████                         | 38/48 [47:53&lt;11:56, 71.68s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/input/msi/ROI057_PROSTATE_TMA055_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/input/msi/ROI057_PROSTATE_TMA055.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/imc/ROI057_PROSTATE_TMA055_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/imc/ROI057_PROSTATE_TMA055_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/input/msi/ROI057_PROSTATE_TMA055.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi/ROI057_PROSTATE_TMA055_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi/ROI057_PROSTATE_TMA055_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi/ROI057_PROSTATE_TMA055_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi/ROI057_PROSTATE_TMA055_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/preprocessing/msi/ROI057_PROSTATE_TMA055_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/qc/preprocessing/msi/ROI057_PROSTATE_TMA055_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/qc/preprocessing/msi/ROI057_PROSTATE_TMA055_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/qc/preprocessing/msi/ROI057_PROSTATE_TMA055_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI057_PROSTATE_TMA055/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 81%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                      | 39/48 [48:58&lt;10:28, 69.81s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/input/msi/ROI058_PROSTATE_TMA056_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/input/msi/ROI058_PROSTATE_TMA056.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/imc/ROI058_PROSTATE_TMA056_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/imc/ROI058_PROSTATE_TMA056_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/input/msi/ROI058_PROSTATE_TMA056.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi/ROI058_PROSTATE_TMA056_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi/ROI058_PROSTATE_TMA056_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi/ROI058_PROSTATE_TMA056_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi/ROI058_PROSTATE_TMA056_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/preprocessing/msi/ROI058_PROSTATE_TMA056_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/qc/preprocessing/msi/ROI058_PROSTATE_TMA056_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/qc/preprocessing/msi/ROI058_PROSTATE_TMA056_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/qc/preprocessing/msi/ROI058_PROSTATE_TMA056_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI058_PROSTATE_TMA056/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 83%|████████████████████████████████████████████████████████████████████████████████████████████████████                    | 40/48 [50:14&lt;09:32, 71.62s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/input/msi/ROI059_PROSTATE_TMA057_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/input/msi/ROI059_PROSTATE_TMA057.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/imc/ROI059_PROSTATE_TMA057_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/imc/ROI059_PROSTATE_TMA057_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/input/msi/ROI059_PROSTATE_TMA057.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi/ROI059_PROSTATE_TMA057_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi/ROI059_PROSTATE_TMA057_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi/ROI059_PROSTATE_TMA057_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi/ROI059_PROSTATE_TMA057_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/preprocessing/msi/ROI059_PROSTATE_TMA057_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/qc/preprocessing/msi/ROI059_PROSTATE_TMA057_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/qc/preprocessing/msi/ROI059_PROSTATE_TMA057_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/qc/preprocessing/msi/ROI059_PROSTATE_TMA057_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI059_PROSTATE_TMA057/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████▌                 | 41/48 [51:24&lt;08:16, 70.89s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/input/msi/ROI061_PROSTATE_TMA060_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/input/msi/ROI061_PROSTATE_TMA060.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/imc/ROI061_PROSTATE_TMA060_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/imc/ROI061_PROSTATE_TMA060_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/input/msi/ROI061_PROSTATE_TMA060.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi/ROI061_PROSTATE_TMA060_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi/ROI061_PROSTATE_TMA060_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi/ROI061_PROSTATE_TMA060_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi/ROI061_PROSTATE_TMA060_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/preprocessing/msi/ROI061_PROSTATE_TMA060_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/qc/preprocessing/msi/ROI061_PROSTATE_TMA060_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/qc/preprocessing/msi/ROI061_PROSTATE_TMA060_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/qc/preprocessing/msi/ROI061_PROSTATE_TMA060_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI061_PROSTATE_TMA060/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████               | 42/48 [52:25&lt;06:48, 68.10s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/input/msi/ROI062_PROSTATE_TMA061_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/input/msi/ROI062_PROSTATE_TMA061.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/imc/ROI062_PROSTATE_TMA061_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/imc/ROI062_PROSTATE_TMA061_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/input/msi/ROI062_PROSTATE_TMA061.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi/ROI062_PROSTATE_TMA061_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi/ROI062_PROSTATE_TMA061_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi/ROI062_PROSTATE_TMA061_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi/ROI062_PROSTATE_TMA061_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/preprocessing/msi/ROI062_PROSTATE_TMA061_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/qc/preprocessing/msi/ROI062_PROSTATE_TMA061_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/qc/preprocessing/msi/ROI062_PROSTATE_TMA061_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/qc/preprocessing/msi/ROI062_PROSTATE_TMA061_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI062_PROSTATE_TMA061/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 43/48 [53:43&lt;05:55, 71.13s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/input/msi/ROI063_PROSTATE_TMA062_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/input/msi/ROI063_PROSTATE_TMA062.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/imc/ROI063_PROSTATE_TMA062_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/imc/ROI063_PROSTATE_TMA062_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/input/msi/ROI063_PROSTATE_TMA062.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi/ROI063_PROSTATE_TMA062_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi/ROI063_PROSTATE_TMA062_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi/ROI063_PROSTATE_TMA062_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi/ROI063_PROSTATE_TMA062_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/preprocessing/msi/ROI063_PROSTATE_TMA062_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/qc/preprocessing/msi/ROI063_PROSTATE_TMA062_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/qc/preprocessing/msi/ROI063_PROSTATE_TMA062_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/qc/preprocessing/msi/ROI063_PROSTATE_TMA062_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI063_PROSTATE_TMA062/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 44/48 [54:59&lt;04:50, 72.53s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/input/msi/ROI067_PROSTATE_TMA065_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/input/msi/ROI067_PROSTATE_TMA065.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/imc/ROI067_PROSTATE_TMA065_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/imc/ROI067_PROSTATE_TMA065_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/input/msi/ROI067_PROSTATE_TMA065.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi/ROI067_PROSTATE_TMA065_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi/ROI067_PROSTATE_TMA065_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi/ROI067_PROSTATE_TMA065_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi/ROI067_PROSTATE_TMA065_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/preprocessing/msi/ROI067_PROSTATE_TMA065_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/qc/preprocessing/msi/ROI067_PROSTATE_TMA065_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/qc/preprocessing/msi/ROI067_PROSTATE_TMA065_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/qc/preprocessing/msi/ROI067_PROSTATE_TMA065_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI067_PROSTATE_TMA065/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 45/48 [56:13&lt;03:38, 72.98s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/input/msi/ROI068_PROSTATE_TMA066_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/input/msi/ROI068_PROSTATE_TMA066.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/imc/ROI068_PROSTATE_TMA066_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/imc/ROI068_PROSTATE_TMA066_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/input/msi/ROI068_PROSTATE_TMA066.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi/ROI068_PROSTATE_TMA066_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi/ROI068_PROSTATE_TMA066_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi/ROI068_PROSTATE_TMA066_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi/ROI068_PROSTATE_TMA066_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/preprocessing/msi/ROI068_PROSTATE_TMA066_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/qc/preprocessing/msi/ROI068_PROSTATE_TMA066_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/qc/preprocessing/msi/ROI068_PROSTATE_TMA066_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/qc/preprocessing/msi/ROI068_PROSTATE_TMA066_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI068_PROSTATE_TMA066/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 46/48 [57:25&lt;02:25, 72.70s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/input/msi/ROI069_PROSTATE_TMA067_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/input/msi/ROI069_PROSTATE_TMA067.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/imc/ROI069_PROSTATE_TMA067_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/imc/ROI069_PROSTATE_TMA067_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/input/msi/ROI069_PROSTATE_TMA067.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi/ROI069_PROSTATE_TMA067_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi/ROI069_PROSTATE_TMA067_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi/ROI069_PROSTATE_TMA067_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi/ROI069_PROSTATE_TMA067_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/preprocessing/msi/ROI069_PROSTATE_TMA067_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/qc/preprocessing/msi/ROI069_PROSTATE_TMA067_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/qc/preprocessing/msi/ROI069_PROSTATE_TMA067_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/qc/preprocessing/msi/ROI069_PROSTATE_TMA067_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI069_PROSTATE_TMA067/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 47/48 [58:33&lt;01:11, 71.31s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MIAAIM PREPROCESSING
MIAAIM VERSION 0.0.2
METHOD: HDIpreprocessing
ROOT FOLDER: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070
RESULTS FOLDER: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi
PROVENANCE FOLDER: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/provenance
QC FOLDER: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/qc/preprocessing/msi

IMPORTING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/input/msi/ROI070_PROSTATE_TMA070_mask.tiff
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/input/msi/ROI070_PROSTATE_TMA070.hdf5
Finished parsing data


PROCESSING DATA
mask: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/imc/ROI070_PROSTATE_TMA070_core_mask.tif
Valid path...
Valid file extension...
file name: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/imc/ROI070_PROSTATE_TMA070_core_UMAP.nii
Finished parsing nifti
Finished
RunOptimalUMAP: computing optimal UMAP embedding
Reloading using processed mask for dimension reduction
Computing UMAP simplicial set on 702 image channels...
Embedding in dimension 1
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 2
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 3
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 4
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 5
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 6
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 7
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 8
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 9
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Embedding in dimension 10
Finished embedding
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:104: RuntimeWarning: divide by zero encountered in log
  Psi_summands[w0] = np.log(1 - Psi[w0])

/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/proc/_fuzzy_ops.py:106: RuntimeWarning: divide by zero encountered in log
  (1 - weights[other]), np.log(1 - Psi[other])

Finding optimal embedding dimension through exponential fit...
Optimal UMAP embedding dimension is 4
working on /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/input/msi/ROI070_PROSTATE_TMA070.hdf5...
Reconstructing image...
Finished spatial mapping
Export: exporting processed image
Exporting f/opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi/ROI070_PROSTATE_TMA070_core_msi_UMAP.nii...
Finished exporting /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi/ROI070_PROSTATE_TMA070_core_msi_UMAP.nii
ExportMask: exporting processed mask
Exporting f/opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi/ROI070_PROSTATE_TMA070_core_msi_mask.tif...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi/ROI070_PROSTATE_TMA070_core_msi_mask.tif is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/preprocessing/msi/ROI070_PROSTATE_TMA070_core_msi_mask.tif
QC: extracting quality control information
Extracting countour from processed masks
Exporting f/opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/qc/preprocessing/msi/ROI070_PROSTATE_TMA070_qcMask.tiff...
/opt/conda/envs/miaaim-dev/lib/python3.10/site-packages/miaaim/io/imwrite/_export.py:66: UserWarning: /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/qc/preprocessing/msi/ROI070_PROSTATE_TMA070_qcMask.tiff is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  skimage.io.imsave(self.path, arr, plugin=&#34;tifffile&#34;)

Finished exporting /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/qc/preprocessing/msi/ROI070_PROSTATE_TMA070_qcMask.tiff
Extracting subsampled masks if used for dimension reduction
Exporting /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/parameters/miaaim-preprocessing-msi.yaml
Exporting /opt/miaaim-20220912-TMA4/data/ROI070_PROSTATE_TMA070/docs/provenance/miaaim-preprocessing-msi.sh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 48/48 [59:46&lt;00:00, 74.72s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_97.png" src="_images/02_2_HDI_MSI_Preprocess_5_97.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_98.png" src="_images/02_2_HDI_MSI_Preprocess_5_98.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_99.png" src="_images/02_2_HDI_MSI_Preprocess_5_99.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_100.png" src="_images/02_2_HDI_MSI_Preprocess_5_100.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_101.png" src="_images/02_2_HDI_MSI_Preprocess_5_101.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_102.png" src="_images/02_2_HDI_MSI_Preprocess_5_102.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_103.png" src="_images/02_2_HDI_MSI_Preprocess_5_103.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_104.png" src="_images/02_2_HDI_MSI_Preprocess_5_104.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_105.png" src="_images/02_2_HDI_MSI_Preprocess_5_105.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_106.png" src="_images/02_2_HDI_MSI_Preprocess_5_106.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_107.png" src="_images/02_2_HDI_MSI_Preprocess_5_107.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_108.png" src="_images/02_2_HDI_MSI_Preprocess_5_108.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_109.png" src="_images/02_2_HDI_MSI_Preprocess_5_109.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_110.png" src="_images/02_2_HDI_MSI_Preprocess_5_110.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_111.png" src="_images/02_2_HDI_MSI_Preprocess_5_111.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_112.png" src="_images/02_2_HDI_MSI_Preprocess_5_112.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_113.png" src="_images/02_2_HDI_MSI_Preprocess_5_113.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_114.png" src="_images/02_2_HDI_MSI_Preprocess_5_114.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_115.png" src="_images/02_2_HDI_MSI_Preprocess_5_115.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_116.png" src="_images/02_2_HDI_MSI_Preprocess_5_116.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_117.png" src="_images/02_2_HDI_MSI_Preprocess_5_117.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_118.png" src="_images/02_2_HDI_MSI_Preprocess_5_118.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_119.png" src="_images/02_2_HDI_MSI_Preprocess_5_119.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_120.png" src="_images/02_2_HDI_MSI_Preprocess_5_120.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_121.png" src="_images/02_2_HDI_MSI_Preprocess_5_121.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_122.png" src="_images/02_2_HDI_MSI_Preprocess_5_122.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_123.png" src="_images/02_2_HDI_MSI_Preprocess_5_123.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_124.png" src="_images/02_2_HDI_MSI_Preprocess_5_124.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_125.png" src="_images/02_2_HDI_MSI_Preprocess_5_125.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_126.png" src="_images/02_2_HDI_MSI_Preprocess_5_126.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_127.png" src="_images/02_2_HDI_MSI_Preprocess_5_127.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_128.png" src="_images/02_2_HDI_MSI_Preprocess_5_128.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_129.png" src="_images/02_2_HDI_MSI_Preprocess_5_129.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_130.png" src="_images/02_2_HDI_MSI_Preprocess_5_130.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_131.png" src="_images/02_2_HDI_MSI_Preprocess_5_131.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_132.png" src="_images/02_2_HDI_MSI_Preprocess_5_132.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_133.png" src="_images/02_2_HDI_MSI_Preprocess_5_133.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_134.png" src="_images/02_2_HDI_MSI_Preprocess_5_134.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_135.png" src="_images/02_2_HDI_MSI_Preprocess_5_135.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_136.png" src="_images/02_2_HDI_MSI_Preprocess_5_136.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_137.png" src="_images/02_2_HDI_MSI_Preprocess_5_137.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_138.png" src="_images/02_2_HDI_MSI_Preprocess_5_138.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_139.png" src="_images/02_2_HDI_MSI_Preprocess_5_139.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_140.png" src="_images/02_2_HDI_MSI_Preprocess_5_140.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_141.png" src="_images/02_2_HDI_MSI_Preprocess_5_141.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_142.png" src="_images/02_2_HDI_MSI_Preprocess_5_142.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_143.png" src="_images/02_2_HDI_MSI_Preprocess_5_143.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_2_HDI_MSI_Preprocess_5_144.png" src="_images/02_2_HDI_MSI_Preprocess_5_144.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_1_MSI_ExportHDF5.html" class="btn btn-neutral float-left" title="MSI Export to HDF5" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03_HE_preprocess_TIFF.html" class="btn btn-neutral float-right" title="HE TMA Core Extraction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Joshua Hess.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>